var vzUrl={regex:new RegExp("^((https?|ftp)://[\\w\\-_]+(\\.[\\w\\-_]+)+|/)([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%!&amp;/~\\+#])?$","gi"),init:function(a){$("#publishForm").on("keyup paste",".vz_url_field",function(b){vzUrl.check_field.call(b.target,true);
});$(".vz_url_field").each(vzUrl.check_field);},check_field:function(a){$field=$(this);if(a&&vzUrl.timer){clearTimeout(vzUrl.timer);}if($field.val()==="http://"||$field.val()===""){vzUrl.set_status($field,"empty");
return;}else{vzUrl.set_status($field,"checking");}if(a){vzUrl.timer=setTimeout(function(){vzUrl.validate($field);},500);}else{vzUrl.validate($field);}},validate:function(c){var b=vzUrl.encode_uri(c.val());
console.log(b);if(!b.match(vzUrl.regex)){vzUrl.set_status(c,"invalid");return;}if(c.hasClass("local")&&b.substr(0,1)!="/"&&b.indexOf(document.domain)==-1){vzUrl.set_status(c,"nonlocal");
return;}var a=b.replace("http","");$.getJSON(EE.BASE+"&callback=?",{caller:"vz_url",url:a},function(d){console.log(d.original,vzUrl.encode_uri(c.val()));
if(d.original!=vzUrl.encode_uri(c.val())){return;}if((d.original==d.final_url)&&(d.http_code>=200)&&(d.http_code<400)){vzUrl.set_status(c,"valid");}else{if(d.original!=d.final_url){vzUrl.set_status(c,"redirect",d);
}else{vzUrl.set_status(c,"invalid");}}});},set_status:function(d,b,c){d.removeClass("empty checking invalid valid nonlocal redirect");d.prev().remove();
var a=d.next().empty();switch(b){case"empty":case"checking":case"valid":break;case"invalid":a.html(vzUrl_settings.errorText);break;case"nonlocal":a.html(vzUrl_settings.nonlocalText);
break;case"redirect":if(d.hasClass("show_redirect")){a.html(vzUrl_settings.redirectText+" "+c.final_url);$("<a/>",{text:vzUrl_settings.redirectUpdate,href:"#","data-final_url":c.final_url,click:function(f){d.val($(this).attr("data-final_url"));
vzUrl.validate(d);return false;}}).appendTo(a);}else{d.removeClass("redirect").addClass("valid");}break;}d.addClass(b);if((b==="valid"||b==="redirect")&&!d.parent().parent().hasClass("matrix")){d.before('<a href="'+d.val()+'" class="vz_url_visit" target="_blank">'+vzUrl_settings.openText+"</a>");
}},encode_uri:function(a){return encodeURI(a).replace(/%25/g,"%").replace(/%5B/g,"[").replace(/%5D/g,"]");}};vzUrl.init();