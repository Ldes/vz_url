var vzUrl={regex:RegExp("^((https?|ftp)://[\\w\\-_]+(\\.[\\w\\-_]+)+|/)([\\w\\-\\.,@?^=%&amp;:/~\\+#]*[\\w\\-\\@?^=%!&amp;/~\\+#])?$","gi"),init:function(){$("#publish").on("keyup paste",".vz_url_field",function(a){vzUrl.check_field.call(a.target,!0)});$(".vz_url_field").each(vzUrl.check_field);Matrix.bind("vz_url","display",function(){vzUrl.check_field.call($(this).find("input"))})},check_field:function(a){$field=$(this);a&&vzUrl.timer&&clearTimeout(vzUrl.timer);"http://"===$field.val()||""===$field.val()?
vzUrl.set_status($field,"empty"):(vzUrl.set_status($field,"checking"),a?vzUrl.timer=setTimeout(function(){vzUrl.validate($field)},a):vzUrl.validate($field))},validate:function(a){var c=a.val();c.match(vzUrl.regex)?a.hasClass("local")&&"/"!=c.substr(0,1)&&-1==c.indexOf(document.domain)?vzUrl.set_status(a,"nonlocal"):$.getJSON(EE.BASE+"&callback=?",{caller:"vz_url",url:c},function(b){b.original==c&&(b.original==b.final_url&&200<=b.http_code&&400>b.http_code?vzUrl.set_status(a,"valid"):b.original!=b.final_url?
vzUrl.set_status(a,"redirect",b):vzUrl.set_status(a,"invalid"))}):vzUrl.set_status(a,"invalid")},set_status:function(a,c,b){a.removeClass("empty checking invalid valid nonlocal redirect");a.prev().remove();var d=a.next().empty();switch(c){case "invalid":d.html(vzUrl_settings.errorText);break;case "nonlocal":d.html(vzUrl_settings.nonlocalText);break;case "redirect":a.hasClass("show_redirect")?(d.html(vzUrl_settings.redirectText+" "+b.final_url),$("<a/>",{text:vzUrl_settings.redirectUpdate,href:"#",
"data-final_url":b.final_url,click:function(){a.val($(this).attr("data-final_url"));vzUrl.validate(a);return!1}}).appendTo(d)):a.removeClass("redirect").addClass("valid")}a.addClass(c);("valid"===c||"redirect"===c)&&!a.parent().parent().hasClass("matrix")&&a.before('<a href="'+a.val()+'" class="vz_url_visit" target="_blank">'+vzUrl_settings.openText+"</a>")}};vzUrl.init();